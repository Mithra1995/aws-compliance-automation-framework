description: Remediate Security Group ingress from 0.0.0.0/0 on port 22
schemaVersion: '0.3'
assumeRole: '{{ AutomationAssumeRole }}'
parameters:
  AutomationAssumeRole:
    type: String
    description: (Required) IAM Role ARN to assume for remediation
  SecurityGroupId:
    type: String
    description: (Required) The ID of the security group
mainSteps:
  - name: RevokePublicSSHAccess
    action: aws:executeAwsApi
    isEnd: true
    inputs:
      Service: ec2
      Api: RevokeSecurityGroupIngress
      GroupId: '{{ SecurityGroupId }}'
      IpPermissions:
        - IpProtocol: tcp
          FromPort: 22
          ToPort: 22
          IpRanges:
            - CidrIp: 0.0.0.0/0
